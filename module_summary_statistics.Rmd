---
title: "AMP-AD Cross Network Summary Statistics"
output:
  html_notebook: default
  html_document: default
---

First, we pull the entire individual module manifest from Synapse.

```{r}
synapseClient::synapseLogin()
individualModuleManifest <- synapseClient::synTableQuery("select * from syn10338156")@values
head(individualModuleManifest)
```

Next, we group the modules by brain region, module name, and method so we can make summary plots.

```{r}
library(dplyr)
moduleSizeSummary <- dplyr::group_by(individualModuleManifest,brainRegion,ModuleName,method)%>%
  dplyr::summarise(numberOfGenes=length(ModuleName))

moduleNumberSummary <- dplyr::group_by(moduleSizeSummary,brainRegion,method) %>%
  dplyr::summarise(numberOfModules = length(method))
```

Then, we plot the module size distribution

```{r}
g <- ggplot2::ggplot(moduleSizeSummary, 
                     ggplot2::aes(x=brainRegion,
                                  y=numberOfGenes,
                                  fill=method))
g <- g + ggplot2::geom_boxplot(position='dodge')
g <- g + ggplot2::scale_y_log10()
g <- g + ggplot2::theme_grey(base_size = 20) 
g
```

and the module number distribution

```{r}
g <- ggplot2::ggplot(moduleNumberSummary, 
                     ggplot2::aes(x=brainRegion,
                                  y=numberOfModules,
                                  fill=method))
g <- g + ggplot2::geom_col(position='dodge')
g <- g + ggplot2::scale_y_log10()
g <- g + ggplot2::theme_grey(base_size = 20) 
g
```

Create size distribution file and upload to synapse

```{r}
module_size_loc <- 'figures/module_size_distribution.tiff'
figureSynId <- 'syn10306508'
tiff(file=module_size_loc,
    height=1687,
    width=2250,
    res=300,
    pointsize = 30)
g <- ggplot2::ggplot(moduleSizeSummary, 
                     ggplot2::aes(x=brainRegion,
                                  y=numberOfGenes,
                                  fill=method))
g <- g + ggplot2::geom_boxplot(position='dodge')
g <- g + ggplot2::scale_y_log10()
g <- g + ggplot2::theme_grey(base_size = 15) 
g
dev.off()

figObj<-synapseClient::File(module_size_loc,
                            parentId=figureSynId,
                            versionComment="Module size summary figure with consensus")
annos <- c('analysisType'='visualization',
           'fileFormat'='tif',
           'consortium'='AMP-AD')
synapseClient::synSetAnnotations(figObj) <- as.list(annos)

permLink <- githubr::getPermlink(repository='blogsdon/AMPADManuscript',
                                 ref = 'branch',
                                 refName = 'summary',
                                 repositoryPath = 'module_summary_statistics.Rmd')

figObj<- synapseClient::synStore(figObj,
                                 used=as.list(c("syn10146524")),
                                 executed=as.list(permLink))
synapseClient::onWeb(figObj)
```
Create number of module distribution and share on Synapse

```{r}
module_number_loc <- 'figures/module_number_distribution.tiff'
figureSynId <- 'syn10306508'
tiff(file=module_number_loc,
    height=1687,
    width=2250,
    res=300,
    pointsize = 30)
g <- ggplot2::ggplot(moduleNumberSummary, 
                     ggplot2::aes(x=brainRegion,
                                  y=numberOfModules,
                                  fill=method))
g <- g + ggplot2::geom_col(position='dodge')
g <- g + ggplot2::scale_y_log10()
g <- g + ggplot2::theme_grey(base_size = 15)
g
dev.off()

figObj<-synapseClient::File(module_number_loc,
                            parentId=figureSynId,
                            versionComment="Module number summary figure with consensus")
annos <- c('analysisType'='visualization',
           'fileFormat'='tif',
           'consortium'='AMP-AD')
synapseClient::synSetAnnotations(figObj) <- as.list(annos)

permLink <- githubr::getPermlink(repository='blogsdon/AMPADManuscript',
                                 ref = 'branch',
                                 refName = 'summary',
                                 repositoryPath = 'module_summary_statistics.Rmd')

figObj<- synapseClient::synStore(figObj,
                                 used=as.list(c("syn10146524")),
                                 executed=as.list(permLink))
synapseClient::onWeb(figObj)
```


Push html notebook to Synapse.
```{r}
notebook_loc <- 'module_summary_statistics.nb.html'
notebookFolderId <- 'syn10306449'
nbObj <- synapseClient::File(notebook_loc,
                             parentId=notebookFolderId,
                             versionComment="Store of notebook for module summaries with consensus")
annos <- c('fileFormat'='rmd',
           'consortium'='AMP-AD')

synapseClient::synSetAnnotations(nbObj) <- as.list(annos)
permLink <- githubr::getPermlink(repository='blogsdon/AMPADManuscript',
                                 ref = 'branch',
                                 refName = 'summary',
                                 repositoryPath = 'module_summary_statistics.Rmd')

nbObj<- synapseClient::synStore(nbObj,
                                 used=as.list(c("syn10146524")),
                                 executed=as.list(permLink))
synapseClient::onWeb(nbObj)

```

